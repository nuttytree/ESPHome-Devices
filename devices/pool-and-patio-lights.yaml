substitutions:
  device_id: pool-and-patio-lights
  device_name: Pool and Patio Lights
  board: esp01_1m
  ip_address: !secret pool-and-patio-lights-ip
  ota_pwd: !secret pool-and-patio-lights-ota-pwd
  api_pwd: !secret pool-and-patio-lights-api-pwd
  ap_wifi_pwd: !secret pool-and-patio-lights-ap-pwd
  wifi_ssid: !secret new-wifi-ssid
  wifi_password: !secret new-wifi-password
  ip_subnet: !secret new-ip-subnet
  ip_gateway: !secret new-ip-gateway

packages:
  device_base: !include ../packages/device_base.yaml

external_components:
  - source:
      type: local
      path: ../components 
    components: [ treo_led_pool_light, binary_light_with_power ]
  - source: github://cbpowell/ESPSense
    components: [ espsense ]

binary_sensor:
  - platform: gpio
    id: patio_lights_button
    pin:
      number: 12
      mode: INPUT_PULLUP
    on_press:
      then:
        - homeassistant.service:
            service: homeassistant.toggle
            data:
              entity_id: light.patio_lights
  - platform: gpio
    id: pool_lights_button
    pin:
      number: 5
      mode: INPUT_PULLUP
    on_press:
      then:
        - light.toggle: pool_lights
  - platform: gpio
    id: color_button
    pin:
      number: 3
      mode: INPUT_PULLUP
    on_press:
      then:
        - lambda: |-
            static_cast<TreoLedPoolLight *>(id(pool_lights).get_output())->next_color();
  - platform: homeassistant
    id: patio_lights
    entity_id: light.patio_lights
    on_press:
      then:
        - switch.turn_on: patio_lights_indicator
    on_release:
      then:
        - switch.turn_off: patio_lights_indicator

espsense:
  plugs:
    - name: Pool Lights
      power_sensor: pool_light_power
      voltage: 120

light:
  - platform: treo_led_pool_light
    id: pool_lights
    name: "Pool Lights"
    pin: 15
    power:
      id: pool_light_power
      name: Pool Lights Power
      light_wattage: 10.0

sensor:
  - platform: total_daily_energy
    name: Pool Lights
    icon: mdi:flash
    power_id: pool_light_power
    method: left
    min_save_interval: 10min

status_led:
  pin:
    number: 0
    inverted: true

switch:
  - platform: gpio
    id: patio_lights_indicator
    pin: 13

time:
  - platform: homeassistant
